import{S as e,i as t,s as o,e as s,c as l,a as n,d as a,b as r,f as i,G as c,A as h,H as d,J as f,t as u,k as p,g as x,n as y,O as g,E as m,M as v,N as w}from"../chunks/vendor-a0d02d92.js";import{S as b}from"../chunks/Server-039a48e0.js";function E(e){let t,o,c,h,d,f,b,E,T,I,N,S,k,A,C;return{c(){t=s("div"),o=s("div"),c=s("div"),h=s("div"),d=u("Overworld"),f=p(),b=s("div"),E=u("Nether"),T=p(),I=s("div"),N=u("End"),S=p(),k=s("canvas"),this.h()},l(e){t=l(e,"DIV",{class:!0});var s=n(t);o=l(s,"DIV",{class:!0});var r=n(o);c=l(r,"DIV",{class:!0});var i=n(c);h=l(i,"DIV",{class:!0});var u=n(h);d=x(u,"Overworld"),u.forEach(a),f=y(i),b=l(i,"DIV",{class:!0});var p=n(b);E=x(p,"Nether"),p.forEach(a),T=y(i),I=l(i,"DIV",{class:!0});var g=n(I);N=x(g,"End"),g.forEach(a),i.forEach(a),S=y(r),k=l(r,"CANVAS",{class:!0}),n(k).forEach(a),r.forEach(a),s.forEach(a),this.h()},h(){r(h,"class","text-gray-400 border-gray-400"),g(h,"border-b","O"===e[3]),r(b,"class","text-gray-400 border-gray-400"),g(b,"border-b","N"===e[3]),r(I,"class","text-gray-400 border-gray-400"),g(I,"border-b","E"===e[3]),r(c,"class","w-full flex justify-around"),r(k,"class","w-full rounded m-5 p-5 h-[50rem] flex-col flex"),r(o,"class","w-2/3 flex-col flex"),r(t,"class","w-full flex justify-center")},m(s,l){i(s,t,l),m(t,o),m(o,c),m(c,h),m(h,d),m(c,f),m(c,b),m(b,E),m(c,T),m(c,I),m(I,N),m(o,S),m(o,k),e[7](k),A||(C=[v(h,"click",e[4]),v(b,"click",e[5]),v(I,"click",e[6])],A=!0)},p(e,t){8&t&&g(h,"border-b","O"===e[3]),8&t&&g(b,"border-b","N"===e[3]),8&t&&g(I,"border-b","E"===e[3])},d(o){o&&a(t),e[7](null),A=!1,w(C)}}}function T(e){let t,o,h,d,f;return{c(){t=s("div"),o=u("You are not logged in. Click "),h=s("a"),d=u("here"),f=u(" to login"),this.h()},l(e){t=l(e,"DIV",{});var s=n(t);o=x(s,"You are not logged in. Click "),h=l(s,"A",{href:!0});var r=n(h);d=x(r,"here"),r.forEach(a),f=x(s," to login"),s.forEach(a),this.h()},h(){r(h,"href","/")},m(e,s){i(e,t,s),m(t,o),m(t,h),m(h,d),m(t,f)},p:c,d(e){e&&a(t)}}}function I(e){let t,o,h,d,f;return{c(){t=s("div"),o=s("div"),h=u("Can't connect to server. Setup connection "),d=s("a"),f=u("here"),this.h()},l(e){t=l(e,"DIV",{class:!0});var s=n(t);o=l(s,"DIV",{class:!0});var r=n(o);h=x(r,"Can't connect to server. Setup connection "),d=l(r,"A",{href:!0});var i=n(d);f=x(i,"here"),i.forEach(a),r.forEach(a),s.forEach(a),this.h()},h(){r(d,"href","/"),r(o,"class","pr-5"),r(t,"class","flex pt-5")},m(e,s){i(e,t,s),m(t,o),m(o,h),m(o,d),m(d,f)},p:c,d(e){e&&a(t)}}}function N(e){let t;function o(e,t){return e[1]?e[2]?E:T:I}let h=o(e),d=h(e);return{c(){t=s("div"),d.c(),this.h()},l(e){t=l(e,"DIV",{class:!0});var o=n(t);d.l(o),o.forEach(a),this.h()},h(){r(t,"class","text-white p-5")},m(e,o){i(e,t,o),d.m(t,null)},p(e,[s]){h===(h=o(e))&&d?d.p(e,s):(d.d(1),d=h(e),d&&(d.c(),d.m(t,null)))},i:c,o:c,d(e){e&&a(t),d.d()}}}function S(e,t,o){var s=this&&this.__awaiter||function(e,t,o,s){return new(o||(o=Promise))((function(l,n){function a(e){try{i(s.next(e))}catch(t){n(t)}}function r(e){try{i(s.throw(e))}catch(t){n(t)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}i((s=s.apply(e,t||[])).next())}))};let l,n=!1,a=!1;const r={"explored endcity":"/icons/endcity-explored.png","explored endcity and endship":"/icons/endship-endcity-explored.png","endcity and explored endship":"/icons/endship-explored.png","endcity and endship":"/icons/endship.png"};let i;h((()=>{let e=localStorage.getItem("host");null!==e&&p(e),null!==localStorage.getItem("authID")&&o(2,a=!0),i=Object.fromEntries(Object.entries(r).map((([e,t])=>{let o=new Image;return o.src=t,[e,o]})))})),d((()=>{l&&l.ws.close()}));let c=[],u="O";const p=e=>{localStorage.setItem("host",e),l=new b(e,"/map"),l.on("POINTS",(e=>s(void 0,void 0,void 0,(function*(){c=e,console.log("points",e)})))),l.on("OPEN",(()=>{o(1,n=!0),console.log("Connection Opened"),setTimeout((()=>{l.getPoints()}),250)})),l.on("CLOSE",(()=>{o(1,n=!1),l.ws.close(),console.log("Connection Closed")}))};let x,y;const g={x:0,y:0,button:!1,wheel:0,lastX:0,lastY:0,drag:!1};let m=0,v=0;const w={x:0,y:0,scale:1,apply(){y.setTransform(this.scale,0,0,this.scale,this.x,this.y)},scaleAt(e,t,o){this.scale*=o,this.x=e-(e-this.x)*o,this.y=t-(t-this.y)*o},toWorld(e,t,o={x:NaN,y:NaN}){const s=1/this.scale;return o.x=(e-this.x)*s,o.y=(t-this.y)*s,o},toReal(e,t,o={x:NaN,y:NaN}){const s=1/this.scale;return o.x=e/s+this.x,o.y=t/s+this.y,o}};function E(e){if(x){const t=x.getBoundingClientRect();g.x=e.pageX-t.left-scrollX,g.y=e.pageY-t.top-scrollY,g.button="mousedown"===e.type||"mouseup"!==e.type&&g.button,"wheel"===e.type&&(g.wheel+=-e.deltaY,e.preventDefault())}}function T(){if(x){if(y.setTransform(1,0,0,1,0,0),y.globalAlpha=1,x&&(m===x.clientWidth&&v===x.clientHeight||(m=o(0,x.width=x.clientWidth,x),v=o(0,x.height=x.clientHeight,x))),y.clearRect(0,0,m,v),0!==g.wheel){let e=1;e=g.wheel<0?1/1.02:1.02,g.wheel*=.8,Math.abs(g.wheel)<1&&(g.wheel=0),w.scaleAt(g.x,g.y,e)}g.button?g.drag?(w.x+=g.x-g.lastX,w.y+=g.y-g.lastY,g.lastX=g.x,g.lastY=g.y):(g.lastX=g.x,g.lastY=g.y,g.drag=!0):g.drag&&(g.drag=!1),function(e=128){var t,o,s,l,n;t=1/w.scale,o=Math.pow(2,0|Math.log2(e*t)),s=Math.max(m,v)*t+2*o,l=((-w.x*t-o)/o|0)*o,n=((-w.y*t-o)/o|0)*o,w.apply(),y.lineWidth=1,y.strokeStyle="#aaa",y.beginPath();for(let a=0;a<s;a+=o)y.moveTo(l+a,n),y.lineTo(l+a,n+s),y.moveTo(l,n+a),y.lineTo(l+s,n+a);y.setTransform(1,0,0,1,0,0),y.stroke()}(128),function(){y.strokeStyle="blue";let{x:e,y:t}=w.toReal(0,0);y.beginPath(),y.moveTo(e-10,t),y.lineTo(e+10,t),y.moveTo(e,t-10),y.lineTo(e,t+10),y.stroke()}(),function(e,t){const o=w.toWorld(e,t);y.lineWidth=1,y.strokeStyle="red",y.beginPath(),y.fillStyle="red",y.setTransform(1,0,0,1,0,0),y.moveTo(e-15,t),y.lineTo(e+15,t),y.moveTo(e,t-15),y.lineTo(e,t+15),y.stroke(),y.font="14px Arial",y.fillText(`${o.x.toFixed(0)} ${o.y.toFixed(0)}`,e+5,t-5)}(g.x,g.y),c.filter((e=>e.dim===u)).forEach((({x:e,z:t,type:o,name:s})=>{let l=w.toReal(e,t);y.fillStyle="#fff",y.font="14px Arial";let n=!1;if(i[o.toLowerCase()])try{y.drawImage(i[o.toLowerCase()],l.x-25,l.y-25,50,50),n=!0}catch(a){console.log("Error drawing image",a)}(w.scale>.5||!n)&&(s?y.fillText(`${s} (${o})`,l.x-25,l.y+35):y.fillText(`${o}`,l.x-25,l.y+40),y.font="12px Arial",y.fillText(`${e} ${t}`,l.x-15,l.y+52))}))}requestAnimationFrame(T)}return e.$$.update=()=>{1&e.$$.dirty&&x&&null!==x&&(requestAnimationFrame(T),console.log(x),y=x.getContext("2d"),["mousedown","mouseup","mousemove"].forEach((e=>document.addEventListener(e,E))),document.addEventListener("wheel",E,{passive:!1}))},[x,n,a,u,()=>o(3,u="O"),()=>o(3,u="N"),()=>o(3,u="E"),function(e){f[e?"unshift":"push"]((()=>{x=e,o(0,x)}))}]}export default class extends e{constructor(e){super(),t(this,e,S,N,o,{})}}
