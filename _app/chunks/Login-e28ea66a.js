import{C as e,S as s,i as t,s as n,e as a,t as o,k as i,c as r,a as c,g as h,d as l,n as u,b as g,f as d,E as p,M as y,N as m,G as f,O as I,z as b,H as v}from"./vendor-ff869af9.js";const D=function(){const{subscribe:s,set:t,update:n}=e([]);return{subscribe:s,addPage:e=>n((s=>(s.push(e),s))),set:t,setPage:(e,s)=>n((t=>(t[e]=s,t))),addMessage:(e,s=0)=>n((t=>(console.log("adding ",e),t[s].splice(0,0,e),t))),clear:()=>t([])}}();function L(s){const{subscribe:t,set:n,update:a}=e(s);let o;return t((e=>o=e)),{subscribe:t,set:n,update:a,get:()=>o}}const E=L(!1),S=L(!1),w=L(!1),T=L(!1),k=L(0),x=L(new class{constructor(){this.listeners={},this.onceListeners={},this._authenticated=!1,this.on("authSuccess",(e=>{this._authenticated=!0,this.authID=e.authID})),this.on("authFailed",(()=>this.authID=null)),this.on("message",(e=>{console.log(e.data);const s=JSON.parse(e.data);this.callListeners(s.type,s)}))}get authenticated(){return this._authenticated}get connected(){return this.ws.readyState===this.ws.OPEN}connect(e,s=31661,t=!0){this.ws=t?new WebSocket(`wss://${e}:${s}`):new WebSocket(`ws://${e}:${s}`),this.ws.onmessage=e=>this.callListeners("message",e),this.ws.onopen=e=>setTimeout((()=>this.callListeners("open",e)),1),this.ws.onclose=e=>this.callListeners("close",e)}authenticate(e){console.log("authenticating",e),this.send({type:"auth",authID:e})}sendChatMessage(e){this.send({type:"sendMessage",message:e,authID:this.authID})}requestHistory(e,s){this.send({type:"requestHistory",page:e,offset:s,authID:this.authID})}requestPoints(e){this.send({type:"requestPoints",dimension:e,authID:this.authID})}requestTypes(){this.send({type:"requestTypes",authID:this.authID})}login(e){this.send({type:"login",code:e})}on(e,s){this.listeners[e]||(this.listeners[e]=[]);const t=Symbol();return this.listeners[e].push([t,s]),t}remove(e){Object.keys(this.listeners).forEach((s=>{this.listeners[s].map((e=>e[0])).includes(e)&&(this.listeners[s]=this.listeners[s].filter((s=>s[0]!==e)))})),Object.keys(this.onceListeners).forEach((s=>{this.onceListeners[s].map((e=>e[0])).includes(e)&&(this.onceListeners[s]=this.onceListeners[s].filter((s=>s[0]!==e)))}))}once(e,s){this.onceListeners[e]||(this.onceListeners[e]=[]);const t=Symbol();return this.onceListeners[e].push([t,s]),t}send(e){this.ws.send(JSON.stringify(e))}callListeners(e,s){this.listeners[e]&&this.listeners[e].forEach((e=>e[1](s))),this.onceListeners[e]&&(Object.values(this.onceListeners[e]).forEach((e=>e[1](s))),this.onceListeners[e]=[])}}),O=L(!1),P=L(null),N=L(0),q=L([[],[],[]]),C=L([]),M=L({});function U(){console.log("Setting up");const e=localStorage.getItem("host"),s=localStorage.getItem("authID"),t=new URLSearchParams(location.search).get("code");O.get()||(console.log("Adding listeners"),x.get().on("chatMessage",(e=>{D.addMessage(e.message),k.update((e=>e+1))})),x.get().on("historyData",(e=>{w.set(!1),0==e.items.length&&T.set(!0),D.setPage(e.page,e.items)})),x.get().on("pointsData",(e=>{q.update((s=>(s[e.dimension]=e.points,s)))})),x.get().on("typesData",(e=>{C.set(e.types)})),x.get().on("playerMove",(e=>{M.update((s=>(s[e.username]={x:e.x,y:e.y,z:e.z,dimension:e.dimension},s)))})),x.get().on("authSuccess",(e=>{S.set(!0),P.set(e.authID),t&&history.replaceState(null,null,"/"),localStorage.setItem("authID",e.authID),console.log("set authid",e.authID,S.get())})),x.get().on("message",(e=>console.log(e))),x.get().on("open",(()=>{E.set(!0),t?x.get().login(t):s&&x.get().authenticate(s)})),x.get().on("close",(()=>{E.set(!1)})),x.get().on("authSuccess",(()=>{setTimeout((()=>{x.get().requestHistory(0,0)}),10)})),O.set(!0)),!E.get()&&e&&(console.log("Connecting"),x.get().connect(e))}function j(e){let s,t,n,b,v,D,L,E,S,w;return{c(){s=a("div"),t=a("div"),n=o("Enter server name"),b=i(),v=a("input"),D=i(),L=a("button"),E=o("Connect"),this.h()},l(e){s=r(e,"DIV",{class:!0});var a=c(s);t=r(a,"DIV",{class:!0});var o=c(t);n=h(o,"Enter server name"),o.forEach(l),b=u(a),v=r(a,"INPUT",{class:!0}),D=u(a),L=r(a,"BUTTON",{class:!0});var i=c(L);E=h(i,"Connect"),i.forEach(l),a.forEach(l),this.h()},h(){g(t,"class","pr-5"),g(v,"class","bg-gray-700 rounded p-1"),g(L,"class","mx-4 p-1 px-2 rounded bg-gray-700 hover:bg-gray-800"),g(s,"class","flex flex-wrap pt-5")},m(a,o){d(a,s,o),p(s,t),p(t,n),p(s,b),p(s,v),y(v,e[0]),p(s,D),p(s,L),p(L,E),S||(w=[m(v,"input",e[2]),m(v,"keydown",e[3]),m(L,"click",e[4])],S=!0)},p(e,[s]){1&s&&v.value!==e[0]&&y(v,e[0])},i:f,o:f,d(e){e&&l(s),S=!1,I(w)}}}function H(e,s,t){let n="";b((()=>{U()}));const a=e=>{localStorage.setItem("host",e),U()};return[n,a,function(){n=this.value,t(0,n)},e=>{"Enter"===e.key&&(a(n),t(0,n=""))},()=>{a(n),t(0,n="")}]}class V extends s{constructor(e){super(),t(this,e,H,j,n,{})}}function $(e){let s,t,n,b,v,D,L,E,S,w,T,k,x;return{c(){s=a("div"),t=a("div"),n=o("You are not logged in. To login type "),b=a("code"),v=o("/login"),D=o(" on the server and enter your code here"),L=i(),E=a("input"),S=i(),w=a("button"),T=o("Login"),this.h()},l(e){s=r(e,"DIV",{});var a=c(s);t=r(a,"DIV",{});var o=c(t);n=h(o,"You are not logged in. To login type "),b=r(o,"CODE",{});var i=c(b);v=h(i,"/login"),i.forEach(l),D=h(o," on the server and enter your code here"),o.forEach(l),L=u(a),E=r(a,"INPUT",{class:!0}),S=u(a),w=r(a,"BUTTON",{class:!0});var g=c(w);T=h(g,"Login"),g.forEach(l),a.forEach(l),this.h()},h(){g(E,"class","bg-gray-700 rounded p-1"),g(w,"class","mx-4 p-1 px-2 rounded bg-gray-700 hover:bg-gray-800")},m(a,o){d(a,s,o),p(s,t),p(t,n),p(t,b),p(b,v),p(t,D),p(s,L),p(s,E),y(E,e[0]),p(s,S),p(s,w),p(w,T),k||(x=[m(E,"input",e[2]),m(E,"keydown",e[3]),m(w,"click",e[4])],k=!0)},p(e,[s]){1&s&&E.value!==e[0]&&y(E,e[0])},i:f,o:f,d(e){e&&l(s),k=!1,I(x)}}}function z(e,s,t){let n,a;v(e,E,(e=>t(5,n=e))),v(e,x,(e=>t(6,a=e)));let o="";b((()=>{U()}));const i=e=>{n&&a.login(e)};return[o,i,function(){o=this.value,t(0,o)},e=>{"Enter"===e.key&&(i(o),t(0,o=""))},()=>{i(o),t(0,o="")}]}class _ extends s{constructor(e){super(),t(this,e,z,$,n,{})}}export{V as C,_ as L,T as a,S as b,D as c,E as d,C as e,q as f,U as g,k as h,N as m,M as p,w as r,x as s};
